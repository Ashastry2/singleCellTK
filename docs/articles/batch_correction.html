<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batch Correction on SingleCellExperiment Object • singleCellTK</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Batch Correction on SingleCellExperiment Object">
<meta property="og:description" content="singleCellTK">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">singleCellTK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/introduction_to_SCTK.html">Introduction to SingleCellToolKit</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Command Line Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/import_scRNAseq_data_as_SCE.html">Import data into SCTK</a>
    </li>
    <li>
      <a href="../articles/run_qc.html">Quality Control</a>
    </li>
    <li>
      <a href="../articles/normalization.html">Normalization</a>
    </li>
    <li>
      <a href="../articles/batch_correction.html">Batch Correction</a>
    </li>
    <li>
      <a href="../articles/variability.html">Variability</a>
    </li>
    <li>
      <a href="../articles/feature_selection.html">Feature Selection</a>
    </li>
    <li>
      <a href="../articles/differential_expression.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/visualize_results.html">Visualize Results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/compbiomed/singleCellTK">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="batch_correction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Batch Correction on SingleCellExperiment Object</h1>
                        <h4 class="author">Yichen Wang</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/compbiomed/singleCellTK/blob/master/vignettes/batch_correction.Rmd"><code>vignettes/batch_correction.Rmd</code></a></small>
      <div class="hidden name"><code>batch_correction.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>For this section, we wrapped 12 methods into functions that perform batch effect correction on an SingleCellExperiment (SCE) object and return the input SCE object with a corrected matrix updated in-place. Here is a table for the method names, citations, and corresponding wrapper functions:</p>
<table class="table">
<tr>
<th>
Method
</th>
<th>
Citation
</th>
<th>
Function
</th>
</tr>
<tr>
<td>
BBKNN
</td>
<td>
Polański, Krzysztof and et al., 2019
</td>
<td>
<a href="../reference/runBBKNN.html">runBBKNN()</a>
</td>
</tr>
<tr>
<td>
ComBat
</td>
<td>
Yuqing Zhang and et al., 2018
</td>
<td>
<a href="../reference/runComBat.html">runComBat()</a>
</td>
</tr>
<tr>
<td>
FastMNN
</td>
<td>
Aaron Lun, 2018
</td>
<td>
<a href="../reference/runFastMNN.html">runFastMNN()</a>
</td>
</tr>
<tr>
<td>
MNN
</td>
<td>
Laleh Haghverdi, 2018
</td>
<td>
<a href="../reference/runMNNCorrect.html">runMNNCorrect()</a>
</td>
</tr>
<tr>
<td>
Harmony
</td>
<td>
Ilya Korsunsky and et al., 2019
</td>
<td>
<a href="../reference/runHarmony.html">runHarmony()</a>
</td>
</tr>
<tr>
<td>
LIGER
</td>
<td>
Joshua Welch, et al., 2018
</td>
<td>
<a href="../reference/runLIGER.html">runLIGER()</a>
</td>
</tr>
<tr>
<td>
Limma
</td>
<td>
Gordon K Smyth, et al., 2003
</td>
<td>
<a href="../reference/runLimmaBC.html">runLimmaBC()</a>
</td>
</tr>
<tr>
<td>
Scanorama
</td>
<td>
Brian Hie et al, 2019
</td>
<td>
<a href="../reference/runSCANORAMA.html">runSCANORAMA()</a>
</td>
</tr>
<tr>
<td>
scGen
</td>
<td>
Mohammad Lotfollah et al., 2019
</td>
<td>
<a href="../reference/runSCGEN.html">runSCGEN()</a>
</td>
</tr>
<tr>
<td>
scMerge
</td>
<td>
Yingxin Lin et al., 2019
</td>
<td>
<a href="../reference/runSCMerge.html">runSCMerge()</a>
</td>
</tr>
<tr>
<td>
Seurat Integration
</td>
<td>
Tim Stuart et al., 2019
</td>
<td>
<a href="../reference/runSeurat3Integration.html">runSeurat3Integration()</a>
</td>
</tr>
<tr>
<td>
ZINBWaVE
</td>
<td>
Davide Risso et al., 2018
</td>
<td>
<a href="../reference/runZINBWaVE.html">runZINBWaVE()</a>
</td>
</tr>
</table>
</div>
<div id="prerequsites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequsites" class="anchor"></a>Prerequsites</h2>
<ul>
<li>Latest <code>SingleCellTK</code> installed.</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">devtools</span>)
<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"compbiomed/singleCellTK@devel"</span>)</pre></body></html></div>
<ul>
<li>An SCE object consists of multiple batches of datasets that introduce batch effect to be corrected.<br>
Here we present an example dataset that is combined from “pbmc3k” and “pbmc4k”</li>
</ul>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">singleCellTK</span>)
<span class="no">pbmc3k</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/importExampleData.html">importExampleData</a></span>(<span class="st">'pbmc3k'</span>)
<span class="no">pbmc3k</span>
<span class="no">pbmc4k</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/importExampleData.html">importExampleData</a></span>(<span class="st">'pbmc4k'</span>)
<span class="no">pbmc4k</span>
<span class="co"># The way to combine multiple SCE objects varies depending on existing cell/gene metadata</span>
<span class="no">isecGene</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">pbmc3k</span>), <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">pbmc4k</span>))
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">isecGene</span>)
<span class="no">pbmc3k.isec</span> <span class="kw">&lt;-</span> <span class="no">pbmc3k</span>[<span class="no">isecGene</span>,]
<span class="no">pbmc4k.isec</span> <span class="kw">&lt;-</span> <span class="no">pbmc4k</span>[<span class="no">isecGene</span>,]
<span class="fu">rowData</span>(<span class="no">pbmc4k.isec</span>) <span class="kw">&lt;-</span> <span class="fu">rowData</span>(<span class="no">pbmc3k.isec</span>)
<span class="no">sce.combine</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/combineSCE.html">combineSCE</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">pbmc3k</span> <span class="kw">=</span> <span class="no">pbmc3k.isec</span>, <span class="kw">pbmc4k</span> <span class="kw">=</span> <span class="no">pbmc4k.isec</span>))
<span class="no">sce.combine</span>
<span class="no">sce.small</span> <span class="kw">&lt;-</span> <span class="no">sce.combine</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">sce.combine</span>), <span class="fl">500</span>), <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">sce.combine</span>), <span class="fl">500</span>)]
<span class="co"># Many of the batch correction methods require log-normalized counts</span>
<span class="no">sce.small</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/scater_logNormCounts.html">scater_logNormCounts</a></span>(<span class="kw">inSCE</span> <span class="kw">=</span> <span class="no">sce.small</span>, <span class="kw">logAssayName</span> <span class="kw">=</span> <span class="st">'logcounts'</span>, <span class="kw">useAssay</span> <span class="kw">=</span> <span class="st">'counts'</span>)</pre></body></html></div>
</div>
<div id="run-batch-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#run-batch-correction" class="anchor"></a>Run Batch Correction</h2>
<p>The basic way to run a batch correction method from singleCellTK is to select a function for the corresponding method above, and input the SCE object, specify the assay to correct, and the batch annotation.</p>
<div id="bbknn" class="section level3">
<h3 class="hasAnchor">
<a href="#bbknn" class="anchor"></a>BBKNN</h3>
<p>BBKNN is a method</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">sce.small</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runBBKNN.html">runBBKNN</a></span>(<span class="kw">inSCE</span> <span class="kw">=</span> <span class="no">sce.small</span>, <span class="kw">useAssay</span> <span class="kw">=</span> <span class="st">'logcounts'</span>, <span class="kw">batch</span> <span class="kw">=</span> <span class="st">'sample'</span>, <span class="kw">reducedDimName</span> <span class="kw">=</span> <span class="st">'BBKNN'</span>)
<span class="no">sce.small</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joshua D. Campbell, David Jenkins, Tyler Faits, Mohammed Muzamil Khan, Zhe Wang, Emma Briars, Sebastian Carrasco Pro, W. Evan Johnson, Yusuke Koga, Shruthi Bandyadka, Anastasia Leshchyk, Rui Hong, Yichen Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
