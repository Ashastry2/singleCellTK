---
title: "Pathway Analysis"
author: "Nida Pervaiz"
output:
  pdf_document:
    toc: yes
    toc_depth: '5'
  html_document:
    toc: yes
    toc_depth: 5
bibliography: references.bib
csl: ieee.csl
---

```{r develSetting, include=FALSE}
doEval = FALSE
```

````{=html}
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
````

## Introduction

VAM [@Frost2020.02.18.954321] and GSVA [@pmid23323831] are popular methods for GSE (Gene Set Enrichment) and allows the identification of changes in pathway activity in RNA-Seq data. Overall, gene sets can be uploaded or selected from the available databases and the pathway analysis method can be run on the selected gene sets which can eventually be visualized using Violin plot.
For this section, we provide wrappers of two methods, listed in the table below. All functions takes an input [`SingleCellExperiment`](https://rdrr.io/bioc/SingleCellExperiment/man/SingleCellExperiment.html) (SCE) object and other settings as arguments and returns the same SCE object with results updated in `reducedDim``.  


## Workflow Guide

````{=html}
<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'interactive')" id="ia-button">Interactive Analysis</button>
  <button class="tablinks" onclick="openTab(event, 'console')" id="console-button">Console Analysis</button>
</div>

<div id="interactive" class="tabcontent">
````

**Entry of The Panel**

From anywhere of the UI, the panel for clustering can be accessed from the top navigation panel at the circled tab shown below.  

![PathwayEntry](ui_screenshots/pathwayAnalysis/path_ui_entry.PNG)\

The UI is constructed in a sidebar style, where the left-sided sidebar works for setting the parameters and running the pathway analysis, and the right part main panel is for visualization checking.  


**Run Pathway Analysis**

**1. Choose An Algorithm**

![PathwayAlgo](ui_screenshots/pathwayAnalysis/path_ui_algo.PNG)\

For running any types of pathway analysis, there are always three essential inputs that users should be sure with.

- The data matrix to use - selection input **"Select Assay"**. In terms of pathway analysis, SCTK always requires a full-sized feature expression data (i.e. assay) as a valid input.
- The pathway analysis method - selection input **"Select Method"**. All methods supported are listed as options.
- The geneset collection name - selection input **"Select Geneset Collection"**. All geneset names are listed as options.

After the pathway analysis method is confirmed, the lower part will dynamically switch to the method specific settings.

**2. Parameter Settings**

````{=html}
<details>
  <summary><b>VAM</b></summary>
````  

![VAMParameter](ui_screenshots/pathwayAnalysis/path_ui_VAM.PNG)\

When the selected algorithm is "VAM" , the parameter settings will look like the figure above. The method specific parameters include:

- `center`, If True, values will be mean centered when computating the Mahalanobis statistic.
- `gamma`, If True, a gamma distribution will be fit to the non-zero squared Mahalanobis distances computed from a row-permuted version of the gene expression matrix. The estimated gamma distribution will be used to compute a one-sided p-value for each cell. If False, the p-value will be computed using the standard chi-square approximation for the squared Mahalanobis distance (or non-central if center = FALSE).



````{=html}
</details>
<details>
  <summary><b>GSVA</b></summary>
````  

![GSVAParameter](ui_screenshots/pathwayAnalysis/path_ui_gsva.PNG)\

When the selected algorithm is "GSVA", no additional parameter settings exist other than the three essential inputs common for both; VAM and GSVA. 



````{=html}
</details>
<br/>
````  

**3. Visualization**

![Pathwayresult](ui_screenshots/pathwayAnalysis/path_ui_result.PNG)\

The visualization is implemented with a plotting of cell by geneset matrix score.


````{=html}
<details>
  <summary><b>Detail</b></summary>
````

![Pathwayvisualization](ui_screenshots/pathwayAnalysis/path_ui_visualization.PNG)\

The parameter panel for visualization comprises of:

- The result to visualize - selection input **"Select Score matrix which you want to plot:"**. User should choose one of the data frames produced within the results which they want to visualize.
- The geneset to visualize  - selection input **"Select Geneset:"**. User should choose the geneset from the collection used for running the algorithm.
- The additional condition of grouping the data- selection input **"Select Condition(s) of interest to group data (optional)"**. User may select a condition to group the data in accordance with the colData. 
- Visualization criteria - Boolean input **"Boxplot"**. If TRUE, will plot boxplots for each violin plot. Default TRUE
- Visualization criteria - Boolean input **"Violinplot"**. If TRUE, will plot the violin plot. Default TRUE
- Summarize stats - selection input **"Select summary parameter"**. Adds a summary statistic, as well as a crossbar to the violin plot. Options are "mean" or "median". Default NULL.

 

````{=html}
</details>
</div>

<div id="console" class="tabcontent">
````

The pathway analysis methods listed in the Introduction can be easily applied to an SCE object. Meanwhile, there are other algorithms too but based on performance and effectiveness we here present these two algorithms only. 

**Basic Parameters**

For each of the three functions, the common things are:

- The input SCE object - `inSCE`.
- The user must select the gene sets they would like to upload from `Import Gene Sets` tab - `geneSetCollectionName`. 
- Users need to use `useAssay` for a full-sized expression data. 

As for another essential parameter, the data matrix used for running the algorithm is a must. Here, users should notice that:

- For `runVAM()`, there are two extra parameters: `center` and `gamma`. Please refer to the function manual pages for the details.
 

**Examples**

To demonstrate simple and clear examples, here we use the "PBMC-3k" dataset from "10X" which can be easily imported with SCTK functions. 

```{R clst_import, eval=FALSE, message=FALSE, warning=FALSE, fig.align="center", cache=TRUE, results='hide'}
library(singleCellTK)
sce <- importExampleData("pbmc3k")
```

The preprocessing only includes necessary steps before implementing pathway analysis 

````{=html}
<details>
  <summary><b>Preprocessing</b></summary>
````

```{R clst_prep, eval=FALSE, message=FALSE, warning=FALSE, fig.align="center", cache=TRUE, results='hide'}

sce <- scaterlogNormCounts(sce, assayName = "logcounts")
sce <- importGeneSetsFromMSigDB(inSCE = sce, 
                             categoryIDs = "H",
                             species = "Homo sapiens",
                             mapping = "gene_symbol",
                             by = "rownames")
```

````{=html}
</details>
````

````{=html}
<details>
  <summary><b>Example with VAM</b></summary>
  <details>
    <summary><b>Method specific parameters</b></summary>
````
- `center`, If True, values will be mean centered when computating the Mahalanobis statistic.
- `gamma`, If True, a gamma distribution will be fit to the non-zero squared Mahalanobis distances computed from a row-permuted version of the gene expression matrix. The estimated gamma distribution will be used to compute a one-sided p-value for each cell. If False, the p-value will be computed using the standard chi-square approximation for the squared Mahalanobis distance (or non-central if center = FALSE).

````{=html}
</details>
````

```{R path_VAM, eval=FALSE, message=FALSE, warning=FALSE, fig.align="center", cache=TRUE, results='hide'}
# Directly use an assay
sce <- runVAM(inSCE = sce, geneSetCollectionName = "H", useAssay = "logcounts", center = TRUE, gamma = FALSE)

```

````{=html}
</details>
````

````{=html}
<details>
  <summary><b>Example with GSVA</b></summary>
  
    
````

```{R clst_kmeans, eval=FALSE, message=FALSE, warning=FALSE, fig.align="center", cache=TRUE, results='hide'}
# Directly use an assay
sce <- runGSVA(inSCE = sce, geneSetCollectionName = "GeneSetCollection", useAssay = "logcounts")
```

 

````{=html}
</details>
````



````{=html}
</details>
</div>
<script>
document.getElementById("ia-button").click();
</script>
</body>
````

## References
