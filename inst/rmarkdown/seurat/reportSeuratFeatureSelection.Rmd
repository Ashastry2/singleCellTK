---
title: "Feature Selection using Seurat"
date: "`r format(Sys.time(), '%B %d, %Y')`"
params:
  object: object
output:
  html_document:
    number_sections: yes
    toc: yes
    code_folding: hide
---
## Feature Selection
Generally, a subset of features may represent the biological variation in the overall data and to better capture this true biological signal, it is recommended to identify this subset of features that often exhibit high cell-to-cell variation and use it in the downstream analysis instead of the full set of features. For this purpose, Seurat models the mean-to-variance relationship of the expression data by first computing *log of mean* and *log of variance* using *loess* and then standardizes the values using observed mean and expected variance. The overall variance of each feature is computed from the standardized values by clipping to a maximum value and ordering the features in the order of their variance. Lastly, top genes (by default *2000*) are selected as the top most variable features that represent the highest biological variability and used in the downstream methods.

A scatter plot of standardized variance (y-axis) versus average expression (x-axis) for each of the gene is visualized below. Top 10 most variable genes are labeled with their gene symbols and the points (genes) highlighted in red are considered as highly variable genes.

```{r Seurat Variable Genes, warning=FALSE}
hvgParams <- list(
  inSCE = data,
  hvgMethod = "vst", 
  hvgNumber = seurat.selected.features.numbers)
data <- do.call("seuratFindHVG", hvgParams)

num.variable.genes <- length(seuratVariableFeatures(data))

#remove this and test inside seuratFunction itself
#names(data@metadata$seurat$obj@commands) <- c("seuratNormalizeData.RNA", "FindVariableFeatures.RNA")

Labeled_Variable_data <- seuratPlotHVG(inSCE = data, labelPoints = 10)
Labeled_Variable_data
```
```{r, include=FALSE}
hvgParams$inSCE <- NULL
hvgParams$labelPoints <- 10
metadata(data)$seurat$sctk$report$hvgParams <- hvgParams
```

> A total of *`r seurat.selected.features.numbers`* top variable genes were identified from a total of *`r nrow(data)`* number of features using Seurat's *vst* method that uses log of mean, log of variance and loess to compute the variable features. This subset of *`r seurat.selected.features.numbers`* features was used as an input to dimensionality reduction algorithm. This subset of features was also visualized in a mean-vs-variance plot with the variable features highlighted in red and top most 10 features labeled at the top-right quarter of the plot. 