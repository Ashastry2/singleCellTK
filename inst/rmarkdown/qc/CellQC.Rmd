---
title: "Comprehensive reporting of QC metrics"
date: "`r format(Sys.time(), '%B %d, %Y')`"
params: 
  object: object
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float: true
    collapsed: true
    code_folding: hide
    html_notebook: default
---

```{r "CellQC-lib", warning=FALSE, include=FALSE}
require(singleCellTK)
require(ggplot2)
require(umap)
```

```{r, "CellQC-import", eval = FALSE, include=FALSE}
sce.qc <- params$object
```

```{r, "QCMetrics", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotsQCMetrics<- suppressWarnings(plotRunPerCellQCResults(sce.qc))
    i="QCMetrics"
    cat(paste0('# ', i, ' {.tabset .tabset-fade} \n\n'))
    cat(paste0('## Sum \n\n'))
    plotsQCMetrics$sum
    cat(paste0('## Total \n\n'))
    plotsQCMetrics$detected
    cat(paste0('## Subsets mito sum \n\n'))
    plotsQCMetrics$subsets_mito_sum
    cat(paste0('## Subsets mito detected \n\n'))
    plotsQCMetrics$subsets_mito_detected
    cat(paste0('## Subsets mito percent \n\n'))
    plotsQCMetrics$subsets_mito_percent
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$scater$addPerCellQC
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
description_runPerCellQC <- descriptionRunPerCellQC()
```
# {.unlisted .unnumbered .toc-ignore}
`r description_runPerCellQC`

```{r, "Scrublet", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotsScrublet<- suppressWarnings(plotScrubletResults(sce.qc, reducedDimName="UMAP"))
    i="Scrublet"
    cat(paste0('# ', i, ' {.tabset .tabset-fade} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotsScrublet$scatter_doubletScore
    
    cat(paste0('## Scatter Call \n\n'))
    plotsScrublet$scatter_doubletCall
   
    cat(paste0('## Density Score \n\n'))
    plotsScrublet$density_doubletScore
   
    cat(paste0('## Violin Score \n\n'))
    plotsScrublet$violin_doubletScore
 
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runScrublet
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
description_Scrublet <- descriptionScrublet()
```
# {.unlisted .unnumbered .toc-ignore}
`r description_Scrublet`

```{r, "DoubletFinder-0", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotDoubletFinder<- suppressWarnings(plotDoubletFinderResults(inSCE = sce.qc, reducedDimName = "UMAP"))
    i="DoubletFinder"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score Resolution 1.5 \n\n'))
    plotDoubletFinder$Scatter_Score_Resolution_1.5
    
    cat(paste0('## Scatter Call Resolution 1.5 \n\n'))
    plotDoubletFinder$Scatter_Call_Resolution_1.5
    
    cat(paste0('## Density Resolution 1.5 \n\n'))
    plotDoubletFinder$Density_Resolution_1.5
   
    cat(paste0('## Violin Resolution 1.5 \n\n'))
    plotDoubletFinder$violin_Resolution_1.5
 
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runDoubletFinder
```


```{r, include=FALSE, warning=FALSE, message=FALSE}
description_DoubletFinder <- descriptionDoubletFinder()
```

# {.unlisted .unnumbered .toc-ignore}
`r description_DoubletFinder`


```{r, "DoubletCells", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotDoubletCells<- suppressWarnings(plotDoubletCellsResults(inSCE = sce.qc, reducedDimName = "UMAP"))
    i="DoubletCells"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotDoubletCells$scatter_doubletScore
   
    cat(paste0('## Density Score \n\n'))
    plotDoubletCells$density_doubletScore

    cat(paste0('## Violin Score \n\n'))
    plotDoubletCells$violin_doubletScore
    
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runDoubletCells
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
description_DoubletCells<- descriptionDoubletCells()
```

# {.unlisted .unnumbered .toc-ignore}
`r description_DoubletCells`


```{r, "Cxds", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotCxds<- suppressWarnings(plotCxdsResults( sce.qc, reducedDimName = "UMAP"))
    i="Cxds"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotCxds$scatter_doubletScore
    
    cat(paste0('## Scatter Call \n\n'))
    plotCxds$scatter_doubletCall
   
    cat(paste0('## Density Score \n\n'))
    plotCxds$density_doubletScore

    cat(paste0('## Violin Score \n\n'))
    plotCxds$violin_doubletScore
    
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runCxds
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
descriprion_CxdsResults<- descriptionCXDS()
```

# {.unlisted .unnumbered .toc-ignore}
`r descriprion_CxdsResults`

```{r, "Bcds", results="asis", fig.align="center", warning=FALSE, message=FALSE}
   plotBcds<- suppressWarnings(plotBcdsResults(sce.qc, reducedDimName = "UMAP"))
    i="Bcds"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotBcds$scatter_doubletScore
    
    cat(paste0('## Scatter Call \n\n'))
    plotBcds$scatter_doubletCall
   
    cat(paste0('## Density Score \n\n'))
    plotBcds$density_doubletScore

    cat(paste0('## Violin Score \n\n'))
    plotBcds$violin_doubletScore
    
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runBcds
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
descriprion_BcdsResults<- descriptionBCDS()
```

# {.unlisted .unnumbered .toc-ignore}
`r descriprion_BcdsResults`


```{r, "ScdsHybrid", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotScdsHybrid<- suppressWarnings(plotScdsHybridResults(sce.qc, reducedDimName = "UMAP"))
    i="ScdsHybrid"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotScdsHybrid$scatter_doubletScore
   
    cat(paste0('## Density Score \n\n'))
    plotScdsHybrid$density_doubletScore

    cat(paste0('## Violin Score \n\n'))
    plotScdsHybrid$violin_doubletScore
    
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runCxdsBcdsHybrid
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
description_ScdsHybrid<- descriptionScdsHybrid()
```

# {.unlisted .unnumbered .toc-ignore}
`r description_ScdsHybrid`

```{r, "DecontX", results="asis", fig.align="center", warning=FALSE, message=FALSE}
    plotDecontX<- suppressWarnings(plotDecontXResults(sce.qc, reducedDimName = "UMAP"))
    i="DecontX"
    cat(paste0('# ', i, ' {.tabset} \n\n'))
    cat(paste0('## Scatter Score \n\n'))
    plotDecontX$scatter_decontXContamination
    
    cat(paste0('## Scatter Clusters \n\n'))
    plotDecontX$scatter_decontXClusters
   
    cat(paste0('## Density Score \n\n'))
    plotDecontX$density_decontXContamination

    cat(paste0('## Violin Score \n\n'))
    plotDecontX$violin_decontXContamination
    
    cat(paste0('## Session info \n\n'))
    sce.qc@metadata$runDecontX
```

```{r, include=FALSE, warning=FALSE, message=FALSE}
description_DecontX<- suppressWarnings(descriptionDecontX())
```

# {.unlisted .unnumbered .toc-ignore}
`r description_DecontX`

# SessionInfo
```{r "CellQC-session-info"}
sessionInfo()
```



